<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Borang Pendaftaran (Versi Manual)</title>
  <style>
    /* === Font & Body === */
    @import url('https://fonts.googleapis.com/css2?family=Arial&display=swap');

    :root {
      /* Warna tema diinspirasikan dari borang fizikal */
      --c-primary: #006400; /* Hijau Gelap */
      --c-bg-header: #e0f0e0; /* Hijau Pucuk Pisang */
      --c-border: #888;
      --c-bg-light: #e9e9e9; /* Latar belakang 'luar kertas' */
      --c-text: #000;
      --c-text-label: #333;
      --c-text-help: #555;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: var(--c-bg-light);
      color: var(--c-text);
      padding: 24px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      font-size: 14px;
    }

    /* === Kontena Utama (Kertas) === */
    .container {
      width: 100%;
      max-width: 850px;
      background: #ffffff;
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: 1px solid #333;
      overflow: hidden;
    }
    
    /* === Header Gambar === */
    .form-header-image {
      padding: 0;
      border-bottom: 2px solid #000;
      background-color: #fff;
      text-align: center;
      line-height: 0;
    }
    .form-header-image img {
      width: 100%;
      max-width: 100%;
      display: block;
    }
    
    form {
      padding: 24px;
    }

    /* === 'Fieldset' & 'Legend' === */
    fieldset {
      border: 1px solid #000;
      padding: 0;
      margin: 0;
      margin-bottom: 24px;
    }

    legend {
      padding: 6px 12px;
      font-size: 1em;
      font-weight: 700;
      color: white;
      background: var(--c-primary);
      margin-left: 16px;
      width: auto;
    }

    /* === Kumpulan Borang === */
    .form-section {
      padding: 16px;
    }
    
    .form-group {
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
      font-size: 0.9em;
      color: var(--c-text-label);
    }

    .form-group input[type="text"],
    .form-group input[type="date"],
    .form-group input[type="email"],
    .form-group input[type="url"], /* Input URL ditambah */
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--c-border);
      border-radius: 0;
      box-sizing: border-box;
      font-size: 1em;
      font-family: Arial, sans-serif;
      background: var(--c-bg-header);
    }
    
    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      border-color: var(--c-primary);
      box-shadow: 0 0 0 2px rgba(0, 100, 0, 0.1);
      outline: none;
      background: #fff;
    }
    
    /* Input 'Lain-lain' */
    .lain-lain-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .lain-lain-group .choice-item {
      flex-shrink: 0;
    }
    .lain-lain-group input[type="text"] {
      flex-grow: 1;
    }

    /* === Pilihan (Radio & Checkbox) === */
    .choice-group {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 4px;
    }
    
    .choice-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .choice-item input[type="radio"],
    .choice-item input[type="checkbox"] {
      width: 1.2em;
      height: 1.2em;
      flex-shrink: 0;
      cursor: pointer;
      accent-color: var(--c-primary);
    }
    
    .choice-item label {
      margin: 0;
      font-weight: 400;
      color: var(--c-text);
      cursor: pointer;
    }

    /* === Teks Bantuan === */
    .help-text {
      font-size: 0.85em;
      color: var(--c-text-help);
      margin-top: 4px;
      line-height: 1.4;
      background: var(--c-bg-header);
      padding: 8px;
      border: 1px dashed var(--c-border);
    }
    
    .help-text-white {
      background: #fff !important;
      border-style: solid;
    }
    
    .help-text a {
      color: var(--c-primary);
      font-weight: 600;
      text-decoration: none;
    }
    .help-text a:hover {
      text-decoration: underline;
    }

    /* === Layout Grid === */
    .grid-row {
      display: grid;
      gap: 16px;
      margin-bottom: 12px;
    }
    .grid-col-2 { grid-template-columns: 1fr 1fr; }
    .grid-col-3 { grid-template-columns: 1fr 1fr 1fr; }

    @media (max-width: 700px) {
      .grid-col-2,
      .grid-col-3 {
        grid-template-columns: 1fr;
        margin-bottom: 0;
      }
      .grid-row { margin-bottom: 0; }
      .form-group { margin-bottom: 12px; }
      .lain-lain-group {
        flex-direction: column;
        align-items: flex-start;
      }
      .lain-lain-group input[type="text"] { width: 100%; }
    }

    /* === Butang Hantar === */
    .submit-button {
      width: 100%;
      padding: 12px;
      background-color: var(--c-primary);
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 1.2em;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.2s;
      margin-top: 16px;
    }
    .submit-button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    
    fieldset:disabled {
      background: #f7f7f7;
      opacity: 0.8;
    }
    fieldset:disabled legend { background: #777; }

    /* === MODAL POPUP (SUCCESS) === */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; 
      z-index: 1000; 
      left: 0;
      top: 0;
      width: 100%; 
      height: 100%; 
      overflow: auto; 
      background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 30px;
      border: 1px solid #888;
      width: 90%;
      max-width: 500px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      position: relative;
    }

    .modal-icon {
      font-size: 50px;
      color: var(--c-primary);
      margin-bottom: 15px;
    }

    .modal h2 {
      color: var(--c-primary);
      margin-top: 0;
    }

    .modal p {
      font-size: 16px;
      line-height: 1.5;
      color: #333;
    }

    .close-btn {
      background-color: var(--c-primary);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
    }
    .close-btn:hover {
      background-color: #004d00;
    }

  </style>
</head>
<body>

  <div class="container">
    
    <div class="form-header-image">
      <img src="https://raw.githubusercontent.com/kamarul95-cloud/hostqamarul/main/Screenshot_15-11-2025_204740_.jpeg" alt="Borang Permohonan Ahli PAS">
    </div>

    <form id="pendaftaranForm" method="POST">

      <fieldset>
        <legend>A. BUTIR-BUTIR DIRI</legend>
        <div class="form-section">

          <div class="form-group">
            <label for="nama_jawi">1. Nama Penuh (Tulisan Jawi)</label>
            <input type="text" id="nama_jawi" name="nama_jawi">
            <p class="help-text">
              <a href="https://ejawimakmur.my/" target="_blank" rel="noopener noreferrer">
                Klik di sini untuk menukar nama Rumi ke Jawi
              </a>
            </p>
          </div>

          <div class="form-group">
            <label for="nama_rumi">2. Nama Penuh (Tulisan Rumi; ikut Kad Pengenalan)</label>
            <input type="text" id="nama_rumi" name="nama_rumi">
          </div>

          <div class="grid-row grid-col-3">
            <div class="form-group">
              <label for="ic_baru">3. No. Kad Pengenalan Baru</label>
              <input type="text" id="ic_baru" name="ic_baru">
            </div>

            <div class="form-group">
              <label for="ic_lama">4. No. Kad Pengenalan Lama</label>
              <input type="text" id="ic_lama" name="ic_lama">
            </div>
            
            <div class="form-group">
              <label for="tarikh_lahir">5. Tarikh Lahir</label>
              <input type="date" id="tarikh_lahir" name="tarikh_lahir" style="padding: 6px 10px;">
            </div>
          </div>
          
          <div class="form-group" style="margin-top: 16px;">
            <label for="ic_url">Lampirkan Pautan Gambar IC (Depan & Belakang)</label>
            
            <input type="text" id="ic_url" name="ic_url" placeholder="Tampal (Paste) URL gambar IC di sini..." required>
            
            <p class="help-text help-text-white">
              Sila tekan link di bawah untuk ambil gambar & dapatkan URL:
              <br>
              <a href="https://scanner-no-kp-by-kamarul-v2.netlify.app/" target="_blank" rel="noopener noreferrer" style="font-size: 1.1em; font-weight:bold;">
                ðŸ“¸ Klik Sini: Pengimbas IC & Upload
              </a>
              <br>
              <small>(Ambil gambar > Upload > Salin Link > Tampal di kotak atas)</small>
            </p>
          </div>
          <div class="grid-row grid-col-2" style="margin-top: 16px;">
            <div class="form-group">
              <label>6. Jantina</label>
              <div class="choice-group">
                <div class="choice-item">
                  <input type="radio" id="jantina_lelaki" name="jantina" value="Lelaki">
                  <label for="jantina_lelaki">Lelaki</label>
                </div>
                <div class="choice-item">
                  <input type="radio" id="jantina_perempuan" name="jantina" value="Perempuan">
                  <label for="jantina_perempuan">Perempuan</label>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="bangsa">7. Bangsa/Keturunan</label>
              <input type="text" id="bangsa" name="bangsa">
            </div>
          </div>
          
          <div class="form-group">
            <label for="alamat">8. Alamat Surat Menyurat</label>
            <textarea id="alamat" name="alamat" rows="3"></textarea>
          </div>

          <div class="grid-row grid-col-2">
            <div class="form-group">
              <label for="poskod">Poskod</label>
              <input type="text" id="poskod" name="poskod">
            </div>

            <div class="form-group">
              <label for="bandar">Bandar</label>
              <input type="text" id="bandar" name="bandar">
            </div>
          </div>

          <div class="grid-row grid-col-3">
              <div class="form-group">
                <label for="tel_bimbit">9. No. Telefon Bimbit</label>
                <input type="text" id="tel_bimbit" name="tel_bimbit">
              </div>

              <div class="form-group">
                <label for="tel_rumah">10. No. Telefon Rumah</label>
                <input type="text" id="tel_rumah" name="tel_rumah">
              </div>
              
              <div class="form-group">
                <label for="email">11. Alamat E-mel</label>
                <input type="email" id="email" name="email">
              </div>
          </div>
          
          <div class="grid-row grid-col-2">
            <div class="form-group">
              <label>12. Kelulusan</label>
              <div class="choice-group">
                <div class="choice-item">
                  <input type="radio" id="kelulusan_uni" name="kelulusan" value="Universiti" onclick="toggleKelulusanLain(false)">
                  <label for="kelulusan_uni">Universiti</label>
                </div>
                <div class="lain-lain-group">
                  <div class="choice-item">
                    <input type="radio" id="kelulusan_lain" name="kelulusan" value="Lain-lain" onclick="toggleKelulusanLain(true)">
                    <label for="kelulusan_lain">Lain-lain (Nyatakan):</label>
                  </div>
                  <input type="text" id="kelulusan_lain_teks" name="kelulusan_lain_teks" disabled>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="bidang_pengajian">13. Bidang Pengajian</label>
              <input type="text" id="bidang_pengajian" name="bidang_pengajian">
            </div>
          </div>
          
          <div class="grid-row grid-col-2">
            <div class="form-group">
              <label>14. Pekerjaan</label>
              <div class="choice-group">
                <div class="choice-item">
                  <input type="radio" id="kerja_kerajaan" name="pekerjaan" value="Kerajaan">
                  <label for="kerja_kerajaan">Kerajaan</label>
                </div>
                <div class="choice-item">
                  <input type="radio" id="kerja_swasta" name="pekerjaan" value="Swasta">
                  <label for="kerja_swasta">Swasta</label>
                </div>
                <div class="choice-item">
                  <input type="radio" id="kerja_sendiri" name="pekerjaan" value="Sendiri">
                  <label for="kerja_sendiri">Sendiri</label>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="bidang_pekerjaan">15. Bidang Pekerjaan</label>
              <input type="text" id="bidang_pekerjaan" name="bidang_pekerjaan">
            </div>
          </div>
          
        </div>
      </fieldset>

      <fieldset>
        <legend>B. BAYARAN</legend>
        <div class="form-section">
          <label style="margin-bottom: 12px;">Jenis Bayaran (boleh pilih lebih satu)</label>
          <div class="choice-group" id="bayaranCheckboxes">
            <div class="choice-item">
              <input type="checkbox" id="bayar_daftar" name="bayaran_item[]" value="Pendaftaran: RM 2.00">
              <label for="bayar_daftar">1. Pendaftaran: RM 2.00</label>
            </div>
            <div class="choice-item">
              <input type="checkbox" id="bayar_tahunan" name="bayaran_item[]" value="Yuran Tahunan: RM 3.00">
              <label for="bayar_tahunan">2. Yuran Tahunan: RM 3.00</label>
            </div>
            <div class="choice-item">
              <input type="checkbox" id="bayar_sekaligus" name="bayaran_item[]" value="Sekaligus: RM 100.00">
              <label for="bayar_sekaligus">Sekaligus: RM 100.00</label>
            </div>
            <div class="choice-item">
              <input type="checkbox" id="bayar_kad" name="bayaran_item[]" value="Kad Ahli: RM 5.00">
              <label for="bayar_kad">3. Kad Ahli: RM 5.00</label>
            </div>
          </div>

          <input type="hidden" id="jumlah_bayaran" name="jumlah_bayaran" value="0.00">
          <input type="hidden" id="no_resit" name="no_resit" value="">
          
          <p class="help-text">
            1. Bayaran Pendaftaran wajib âœ…<br>
            2. Yuran pilih salah satu antara tahunan atau sekaligus<br>
            3. Kad Ahli pilih jika mahu
          </p>
          
          <p class="help-text help-text-white" style="border: 1px solid var(--c-primary);">
             ðŸ’° **Jumlah Bayaran Dikira:** <span id="totalBayaranDisplay" style="font-weight: 700; color: var(--c-primary);">RM 0.00</span>
          </p>
          
        </div>
      </fieldset>

      <fieldset>
        <legend>C. PENGAKUAN PEMOHON</legend>
        <div class="form-section">
          <div class="form-group">
            <label>Pernyataan</label>
            <p class="help-text" style="background: #fff; border: 1px solid #ccc; padding: 12px; margin-top: 0;">
              Saya mengaku kebenaran dasar PAS dan akan berusaha melaksanakan segala tuntutannya. Saya menerima PERLEMBAGAAN PAS sebagai panduan dan mengaku akan taat dan patuh kepada kepimpinan parti serta akan patuh dalam melaksanakan arahan-arahan dan keputusan-keputusan parti dari masa ke semasa.
            </p>
            <div class="choice-group" style="margin-top: 12px;">
              <div class="choice-item">
                <input type="radio" id="setuju" name="pengakuan" value="Saya setuju" required>
                <label for="setuju" style="font-weight: 600;">Saya bersetuju dengan pengakuan di atas</label>
              </div>
            </div>
          </div>
          
          <div class="grid-row grid-col-2" style="margin-top: 24px;">
            <div class="form-group">
              <label for="disahkan">Disahkan oleh (Tandatangan Pemohon)</label>
              <input type="text" id="disahkan" name="disahkan" placeholder="Tampal URL tandatangan digital..." required>
              <p class="help-text help-text-white">
                <a href="https://tanda-tangan-by-kamarul.netlify.app/" target="_blank" rel="noopener noreferrer">
                  Klik di sini untuk Pad Tandatangan Digital
                </a>
              </p>
            </div>
            
            <div class="form-group">
              <label for="tarikh_hari_ini">Tarikh</label>
              <input type="date" id="tarikh_hari_ini" name="tarikh_hari_ini" style="padding: 6px 10px;" required>
            </div>
          </div>
          
        </div>
      </fieldset>
      
      <fieldset disabled>
        <legend>D. CADANGAN DAN SOKONGAN (Untuk Kegunaan Pejabat)</legend>
        <div class="form-section">
          <div class="grid-row grid-col-2">
            <div class="form-group">
              <label>Nama Pencadang:</label>
              <input type="text" disabled>
              <label style="margin-top: 8px;">No. Ahli:</label>
              <input type="text" disabled>
            </div>
            <div class="form-group">
              <label>Tandatangan:</label>
              <div style="height: 40px; border: 1px solid var(--c-border); background: #eee;"></div>
              <label style="margin-top: 8px;">Tarikh:</label>
              <input type="text" disabled>
            </div>
          </div>
          <hr style="border: 0; border-top: 1px solid var(--c-border); margin: 16px 0;">
          <div class="grid-row grid-col-2">
            <div class="form-group">
              <label>Nama Penyokong:</label>
              <input type="text" disabled>
              <label style="margin-top: 8px;">No. Ahli:</label>
              <input type="text" disabled>
            </div>
            <div class="form-group">
              <label>Tandatangan:</label>
              <div style="height: 40px; border: 1px solid var(--c-border); background: #eee;"></div>
              <label style="margin-top: 8px;">Tarikh:</label>
              <input type="text" disabled>
            </div>
          </div>
        </div>
      </fieldset>
      
      <fieldset disabled>
        <legend>E. PENERIMAAN (Untuk Kegunaan Pejabat)</legend>
        <div class="form-section">
           <div class="grid-row grid-col-2">
            <div class="form-group">
              <label>Penerima Cawangan</label>
              <input type="text" placeholder="Nama Penerima" disabled>
              <input type="text" placeholder="Tandatangan" style="margin-top: 8px;" disabled>
            </div>
            <div class="form-group">
              <label>Penerima Kawasan</label>
              <input type="text" placeholder="Nama Penerima" disabled>
              <input type="text" placeholder="Tandatangan" style="margin-top: 8px;" disabled>
            </div>
           </div>
        </div>
      </fieldset>

      <button type="submit" class="submit-button" id="submitBtn">
        Hantar Borang Permohonan
      </button>

    </form>
  </div>

  <div id="successModal" class="modal">
    <div class="modal-content">
      <div class="modal-icon">âœ…</div>
      <h2>Borang Berjaya Diisi!</h2>
      <p>Terima kasih.</p>
      <p>Sila jemput ahli keluarga dan rakan-rakan bersama menjadi ahli PAS.</p>
        <p>Dibina oleh Qamarul.</p>
      <button class="close-btn" onclick="tutupModal()">Tutup & Kembali</button>
    </div>
  </div>
  
  <script>
    /**
     * Toggle untuk input 'Kelulusan Lain-lain'
     */
    function toggleKelulusanLain(enable) {
      const inputTeks = document.getElementById('kelulusan_lain_teks');
      if (enable) {
        inputTeks.disabled = false;
        inputTeks.focus();
      } else {
        inputTeks.disabled = true;
        inputTeks.value = ''; // Kosongkan jika pilih 'Universiti'
      }
    }
    
    // Fungsi Tutup Modal
    function tutupModal() {
      document.getElementById('successModal').style.display = 'none';
      // Optional: Reload page atau redirect jika perlu
      // window.location.reload(); 
    }
    
    // Helper: extract numeric value from bayaran string like "Pendaftaran: RM 2.00"
    function extractAmount(value) {
        const match = value.match(/RM\s*(\d+\.?\d*)/);
        return match ? parseFloat(match[1]) : 0;
    }
    
    // Helper: Calculate and display total payment
    function calculateTotalPayment() {
        const checkboxes = document.querySelectorAll('#bayaranCheckboxes input[type="checkbox"]:checked');
        let total = 0;
        checkboxes.forEach(cb => {
            total += extractAmount(cb.value);
        });
        
        // Update hidden field and display field
        document.getElementById('jumlah_bayaran').value = total.toFixed(2);
        document.getElementById('totalBayaranDisplay').textContent = 'RM ' + total.toFixed(2);
    }


    /* ============================
        Frontend submit -> Google Apps Script Web App
        ============================ */
    (function () {
      const webAppUrl = "https://script.google.com/macros/s/AKfycbw_ifKoRTR3wxHBMzZPjUIWCTrlZWs7buRB_LMfgDt7zJMZig-SJ-hCbaymPErH85N6zA/exec";
      const form = document.getElementById('pendaftaranForm');
      const submitBtn = document.getElementById('submitBtn');
      const modal = document.getElementById('successModal');

      // Array of field names that should be prefixed with "'" for text formatting in Google Sheet
      const numberFieldsToFormat = [
        'ic_baru', 'ic_lama', 'tel_rumah', 'tel_bimbit', 'poskod'
      ];
      
      // Helper: collect form data, format numbers, and calculate total payment
      function collectFormDataAsFormData(formElement) {
        const fd = new FormData();
        const elements = formElement.elements;
        const bayaranValues = [];
        let totalPayment = 0; // Sebenarnya sudah dikira di calculateTotalPayment, tapi kita kira semula untuk kepastian
        
        // Get total payment from hidden field (already calculated)
        totalPayment = parseFloat(document.getElementById('jumlah_bayaran').value) || 0;

        for (let i = 0; i < elements.length; i++) {
          const el = elements[i];
          if (!el.name || el.disabled) continue;

          if (el.type === 'checkbox' && el.name === 'bayaran_item[]') {
            if (el.checked) {
              // 3. Logik untuk Bayaran (Simpan jenis bayaran sahaja)
              bayaranValues.push(el.value);
            }
          } else if (el.type === 'radio') {
            if (el.checked) {
              fd.append(el.name, el.value);
            }
          } else if (el.name !== 'bayaran_item[]' && el.name !== 'jumlah_bayaran') {
             // Append other fields normally, except the checkbox items and hidden total field
            let value = el.value.trim();

            // 1. Format Nombor/ID dengan simbol '
            if (numberFieldsToFormat.includes(el.name) && value) {
              value = "'" + value;
            }

            fd.append(el.name, value);
          }
        }
        
        // 3. Tambah Jumlah Bayaran dan senarai jenis bayaran yang dipisahkan oleh pipe
        fd.append('jumlah_bayaran', totalPayment.toFixed(2));
        fd.append('bayaran', bayaranValues.join(' , ')); // Satu field 'bayaran' untuk semua jenis bayaran

        return fd;
      }

      form.addEventListener('submit', function (e) {
        e.preventDefault();

        // Basic validation
        const namaRumi = form.querySelector('[name="nama_rumi"]');
        const icUrl = form.querySelector('[name="ic_url"]');
        const setuju = form.querySelector('[name="pengakuan"]:checked');
        const tandatangan = form.querySelector('[name="disahkan"]');
        const tarikh = form.querySelector('[name="tarikh_hari_ini"]');
        
        if (namaRumi.value.trim() === "") {
          alert("Sila isi Nama Penuh (Rumi).");
          namaRumi.focus();
          return;
        }
        
        if (icUrl.value.trim() === "") {
           alert("Sila tampal URL gambar IC.");
           icUrl.focus();
           return;
        }
        
        if (!setuju) {
            alert("Sila tandakan kotak pengakuan pemohon.");
            return;
        }

        if (tandatangan.value.trim() === "") {
            alert("Sila tampal URL Tandatangan Digital.");
            tandatangan.focus();
            return;
        }

        if (tarikh.value.trim() === "") {
            alert("Sila masukkan Tarikh hari ini.");
            tarikh.focus();
            return;
        }
        

        // Disable button semasa menghantar
        submitBtn.disabled = true;
        const originalBtnText = submitBtn.innerHTML;
        submitBtn.innerHTML = "Menghantar...";

        const fd = collectFormDataAsFormData(form);

        fetch(webAppUrl, {
          method: "POST",
          body: fd
        })
        .then(response => {
          if (response.ok) {
            return response.json().catch(() => response.text());
          } else {
            return response.text().then(txt => { throw new Error(txt || 'HTTP error ' + response.status); });
          }
        })
        .then(result => {
          // Berjaya - Tunjuk Modal (Ganti Alert)
          modal.style.display = 'flex';
          
          form.reset();
          toggleKelulusanLain(false);
          calculateTotalPayment(); // Reset total payment display
        })
        .catch(err => {
          console.error("Hantar gagal:", err);
          alert("Maaf, penghantaran gagal. Sila semak sambungan internet.");
        })
        .finally(() => {
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalBtnText;
        });
      });
      
      // Event Listeners for Bayaran Calculation
      const bayaranCheckboxes = document.querySelectorAll('#bayaranCheckboxes input[type="checkbox"]');
      bayaranCheckboxes.forEach(cb => {
          cb.addEventListener('change', calculateTotalPayment);
      });
      
      // Initial setup
      document.addEventListener('DOMContentLoaded', function() {
        toggleKelulusanLain(false);
        calculateTotalPayment(); // Calculate initial total (should be 0.00)
      });
      
    })();
  </script>

</body>
</html>----
